<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Localiza√ß√£o</title>
</head>
<body>
    <h1>Isso √© apenas um teste!üôèüèº</h1>
 	<h1>Sua Localiza√ß√£o √©:</h1>
 	<h2></h2>
 	<h1>Establecimento: <br> Latitude: -15.189189189189 <br> Longitude: 12.17299995810</h1>
 	<h3></h3>
 	<div id="corpo"></div>
 	

 	<script>
	
	/*let h2 = document.querySelector('h2');

function success(pos) {
    let userLatitude = pos.coords.latitude;
    let userLongitude = pos.coords.longitude;

    h2.textContent = `Latitude: ${userLatitude}, Longitude: ${userLongitude}`;

    // Coordenadas do estabelecimento (exemplo)
    let establishmentLatitude = -8.8670208;
    let establishmentLongitude = 13.2579328;

    // Calcula a dist√¢ncia entre o usu√°rio e o estabelecimento usando a f√≥rmula Haversine
    let distance = haversine(userLatitude, userLongitude, establishmentLatitude, establishmentLongitude);

    // Limite de dist√¢ncia (exemplo: 50 metros)
    let distanceThreshold = 0.05;  // Em km (50 metros √© um exemplo, ajuste conforme necess√°rio)

    // Verifica se a dist√¢ncia √© menor que o limite
    if (distance < distanceThreshold) {
        console.log('Usu√°rio dentro do estabelecimento.');
   
*/
	let h2 = document.querySelector('h2');

function success(pos) {
	//console.log(pos);
    console.log(pos.coords.latitude, pos.coords.longitude);
    h2.textContent = `Latitude:${pos.coords.latitude}, Longitude:${pos.coords.longitude}`;

    // Coordenadas do estabelecimento (exemplo)
    const estabelecimentoCoords = {
        latitude: -15.189189189189,
        longitude: 12.17299995810
    };

    // Calcula a dist√¢ncia entre o usu√°rio e o estabelecimento
    const distancia = calcularDistancia(pos.coords.latitude , pos.coords.longitude, estabelecimentoCoords.latitude, estabelecimentoCoords.longitude);

    // Define a dist√¢ncia de refer√™ncia (exemplo: 50 metros)
    const distanciaReferencia = 0.010; // 50 metros em km
    console.log(distancia);
    let dis = "";
    if (distancia>1) {
         dis = (distancia).toFixed(2) +" km";
    } else {
         dis = (distancia*1000).toFixed(2) +" metros";
    }
    document.querySelector('h3').textContent= `Voc√™ est√° a ${dis} de dist√¢ncia`;

    // Verifica se o usu√°rio est√° dentro do estabelecimento
    if (distancia <= distanciaReferencia) {
    	document.getElementById("corpo").innerHTML= "<h1>Voc√™ est√° dentro do estabelecimento</h1>";
        console.log('Voc√™ est√° dentro do estabelecimento.');
    } else {
    	document.getElementById("corpo").innerHTML= "Voc√™ est√° fora do estabelecimento.";
        console.log('Voc√™ est√° fora do estabelecimento.');
    }
}

function error(err) {
    console.log(err);
}

// Fun√ß√£o para calcular a dist√¢ncia entre duas coordenadas usando a f√≥rmula de Haversine
function calcularDistancia(lat1, lon1, lat2, lon2) {
    const R = 6371; // Raio da Terra em quil√¥metros
    const dLat = deg2rad(lat2 - lat1);
    const dLon = deg2rad(lon2 - lon1);
    const a =
        Math.sin(dLat / 2) * Math.sin(dLat / 2) +
        Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) *
        Math.sin(dLon / 2) * Math.sin(dLon / 2);
    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
    const distancia = R * c; // Dist√¢ncia em quil√¥metros

    return distancia;
}

function deg2rad(deg) {
    return deg * (Math.PI / 180);
}

//navigator.geolocation.getCurrentPosition(success, error); // Mostra a Localiza√ß√£o est√°tica do Usu√°rio

// Mostra a Localiza√ß√£o din√¢mica do usu√°rio
var watchID = navigator.geolocation.watchPosition(success, error, {
    enableHighAccuracy: true // Pega a localiza√ß√£o mais exata poss√≠vel
});

/*let h2 = document.querySelector('h2');
 		function success(pos) {
    console.log(pos.coords.latitude, pos.coords.longitude);
    h2.textContent = `Latitude:${pos.coords.latitude}, Longitude:${pos.coords.longitude}`;

    // Coordenadas do estabelecimento (ajuste conforme necess√°rio)
    const estabelecimentoCoords = {
        latitude: -8.8670208,
        longitude: 13.2579328
    };

    // Calcula a dist√¢ncia entre o usu√°rio e o estabelecimento
    const distancia = calcularDistancia(
        pos.coords.latitude,
        pos.coords.longitude,
        estabelecimentoCoords.latitude,
        estabelecimentoCoords.longitude
    );

    // Define a dist√¢ncia de refer√™ncia (exemplo: 50 metros)
    const distanciaReferencia = 0.05; // 50 metros em km

    // Verifica se o usu√°rio est√° dentro do estabelecimento
    if (distancia <= distanciaReferencia) {
        console.log('Usu√°rio dentro do estabelecimento.');
    } else {
        console.log('Usu√°rio fora do estabelecimento.');
    }
}

function calcularDistancia(lat1, lon1, lat2, lon2) {
    const R = 6371; // Raio da Terra em quil√¥metros
    const dLat = deg2rad(lat2 - lat1);
    const dLon = deg2rad(lon2 - lon1);
    const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
              Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) *
              Math.sin(dLon / 2) * Math.sin(dLon / 2);
    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
    const distancia = R * c; // Dist√¢ncia em quil√¥metros

    return distancia;
}

function deg2rad(deg) {
    return deg * (Math.PI / 180);
}

*/
</script>
</body>
</html>

